# Ambush Server Setup
# This is an example development setup with JRuby. 
# Other configurations with ruby 1.9 should also be possible.

#0. Ensure OpenSSL is installed and in your path. 
# If not, download it from openssl.org or your distro.
openssl -h

#1. Download and extract JRuby
wget http://jruby.org.s3.amazonaws.com/downloads/1.6.5.1/jruby-bin-1.6.5.1.tar.gz
tar -xvzf jruby-bin-1.6.5.1.tar.gz
cd jruby-1.6.5.1/bin/

#1.5 Install rails
./jruby --1.9 gem install rails

#1.5.1 Wait a while. Ho hum. Go get some coffee.

#2. Check out the Ambush source
cd ../..
git clone ssh://the.url.to.ambush.scriptjunkie/ambush.git
cd ambush/server

#3. Set up the gems and database (assuming the path to your jruby folder is ../../jruby-1.6.5.1/)
../../jruby-1.6.5.1/bin/jruby --1.9 ../../jruby-1.6.5.1/bin/bundle install
../../jruby-1.6.5.1/bin/jruby --1.9 ../../jruby-1.6.5.1/bin/rake db:setup

#3.1 Wait a long time. Like go rent "Gettysburg" long time. Decent movie anyway.

#4. Start your server
../../jruby-1.6.5.1/bin/jruby --1.9 script/rails server

#5. Go to http://localhost:3000/ 
xdg-open http://localhost:3000/

#6. Follow instructions to enter a user/pass for the admin

######### setup for rails vm:

download http://bitnami.org/files/stacks/rubystack/3.2.1-1/bitnami-rubystack-3.2.1-1-opensuse-11.3.zip
Start, change password, and ensure your ssh keys are in

#now, either simply type these commands: 
sudo bash 
wget http://www.scriptjunkie.us/files/installbitnami.sh
sh installbitnami.sh

#
# OR manually do everything
#

cd /opt/bitnami/projects
# git checkout ambush or copy over
# either way the "server" folder should be dropped into /opt/bitnami/projects/
chown -R daemon server/
chgrp -R daemon server/
rm server/Gemfile.lock
cd server
bundle install
#remove or comment out the DocumentRoot directive and the entire <Directory /opt/bitnami/apache2/htdocs> section in /opt/bitnami/apache2/conf/httpd.conf and add the following lines to the end:
DocumentRoot /opt/bitnami/projects/server/public
RailsBaseURI /
<Directory /opt/bitnami/projects/server/public>
	Allow from all
</Directory>
#change 'host: localhost' to 'socket: /opt/bitnami/mysql/tmp/mysql.sock' in config/database.yml

/opt/bitnami/apache2/scripts/ctl.sh stop
/opt/bitnami/apache2/scripts/ctl.sh start
RAILS_ENV=production
export RAILS_ENV
rake db:setup
#it will ask you for your mysql root password; it is bitnami, then you will wait as it seeds the DB.
